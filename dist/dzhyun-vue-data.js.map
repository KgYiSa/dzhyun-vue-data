{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap bcecbf8ccb01a0c06a2d","webpack:///external \"Vue\"","webpack:///./src/DataQuery.js","webpack:///./src/plugin.js","webpack:///./src/DataSource.js","webpack:///./src/DataSubscribe.js","webpack:///./src/index.js","webpack:///external \"Dzhyun\""],"names":["component","props","url","type","String","required","params","Object","shrinkData","Boolean","default","propName","initData","Array","reset","adapt","Function","autoQuery","subscribe","data","request","paramsStr","computed","queryArguments","JSON","parse","callback","output","watch","handler","stringify","deep","immediate","cancel","query","methods","dzhyun","$dzhyun","console","warn","result","Error","$emit","$dzhyunData","beforeMount","destroyed","render","h","ctx","children","$slots","push","map","vnode","componentOptions","propsData","$scopedSlots","length","class","install","Vue","options","getInstance","defineProperties","prototype","configurable","get","$parent","set","value","writable","created","$props","use","close","extends","assign","DzhyunDataSource","DzhyunDataQuery","DzhyunDataSubscribe","module","exports"],"mappings":"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","file":"dzhyun-vue-data.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"Vue\"), require(\"Dzhyun\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"Vue\", \"Dzhyun\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"DzhyunVueData\"] = factory(require(\"Vue\"), require(\"Dzhyun\"));\n\telse\n\t\troot[\"DzhyunVueData\"] = factory(root[\"Vue\"], root[\"Dzhyun\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_0__, __WEBPACK_EXTERNAL_MODULE_6__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 5);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap bcecbf8ccb01a0c06a2d","module.exports = __WEBPACK_EXTERNAL_MODULE_0__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"Vue\"\n// module id = 0\n// module chunks = 0 1","import Vue from 'vue';\n\nexport default Vue.component('dzhyun-data-query', {\n  props: {\n    url: {\n      type: String,\n      required: true\n    },\n    params: Object,\n    shrinkData: {\n      type: Boolean,\n      default: true\n    },\n    propName: {\n      type: String,\n      default: 'data',\n    },\n\n    // 初始数据，默认[]\n    initData: {\n      type: [Object, Array],\n      default: function() { return []; },\n    },\n\n    // 是否在改变参数时重置数据为初始数据\n    reset: {\n      type: Boolean,\n      default: false,\n    },\n    adapt: Function,\n\n    // 是否自动查询，默认true\n    autoQuery: {\n      type: Boolean,\n      default: true,\n    },\n\n    // 是否订阅数据，默认false\n    subscribe: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  data: function() {\n    return {\n      request: null,\n      data: null,\n      paramsStr: null,\n    };\n  },\n  computed: {\n    queryArguments() {\n      return [this.url, JSON.parse(this.paramsStr), this.callback, this.shrinkData];\n    },\n    output() {\n      return this.data || this.initData;\n    },\n  },\n  watch: {\n    params: {\n      handler: function() {\n        this.paramsStr = JSON.stringify(this.params || {});\n      },\n      deep: true,\n      immediate: true,\n    },\n\n    // 查询参数变化，取消订阅后重新查询\n    queryArguments() {\n      if (this.autoQuery) {\n        this.cancel();\n        this.query();\n      }\n    }\n  },\n  methods: {\n    query() {\n      const dzhyun = this.$dzhyun;\n      if (!dzhyun) {\n        console.warn('未创建Dzhyun');\n        return;\n      }\n      this.request = this.subscribe ? dzhyun.subscribe(...this.queryArguments) : dzhyun.query(...this.queryArguments);\n    },\n    cancel() {\n      if (this.request) {\n        this.request.cancel();\n      }\n      if (this.reset) {\n        this.data = null;\n      }\n    },\n    callback(result) {\n      if (result instanceof Error) {\n        this.$emit('error', result);\n      } else {\n        if (this.adapt) result = this.adapt(result, this.data);\n        this.$dzhyunData = result;\n        this.data = result;\n        this.$emit('data', result);\n      }\n    },\n  },\n  beforeMount() {\n    if (this.autoQuery) {\n      // 挂载前第一次请求\n      this.query();\n    }\n  },\n  destroyed() {\n    // 实例销毁后，取消订阅\n    this.cancel();\n  },\n  render(h, ctx) {\n    const children = [];\n    \n    // 将数据注入子组件的props\n    if (this.$slots.default) {\n      children.push(...this.$slots.default.map((vnode) => {\n        if (vnode.componentOptions && vnode.componentOptions.propsData) {\n          vnode.componentOptions.propsData[this.propName] = this.output;\n        }\n        return vnode;\n      }));\n    }\n    if (this.$scopedSlots && this.$scopedSlots.default) {\n      children.push(...this.$scopedSlots.default({\n        [this.propName]: this.output,\n      }));\n    }\n    if (children.length <= 1) {\n      return children[0];\n    }\n    return h('div', { class: 'dzhyun-data-query' }, children);\n  },\n});\n\n\n\n// WEBPACK FOOTER //\n// ./src/DataQuery.js","import Dzhyun from 'dzhyunjs';\n\nexport default {\n  install(Vue, options = {}) {\n    let dzhyun = options.dzhyun;\n    if (!dzhyun) {\n      dzhyun = this.getInstance(options);\n    }\n    Object.defineProperties(Vue.prototype, {\n      $dzhyun: {\n        configurable: true,\n        get: function() {\n          return this.$parent ? this.$parent.$dzhyun : dzhyun;\n        },\n        set: function(value) {\n          Object.defineProperties(this, {\n            $dzhyun: {\n              writable: true,\n              value\n            }\n          });\n        },\n      },\n      $dzhyunData: {\n        configurable: true,\n        get: function() {\n          return this.$parent ? this.$parent.$dzhyunData : null;\n        },\n        set: function(value) {\n          Object.defineProperties(this, {\n            $dzhyunData: {\n              writable: true,\n              value\n            }\n          });\n        },\n      }\n    });\n  },\n\n  getInstance(options) {\n    return new Dzhyun(options);\n  },\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/plugin.js","import Vue from 'vue';\nimport plugin from './plugin';\n\nexport default Vue.component('dzhyun-data-source', {\n  props: ['address', 'dataType', 'token', 'compresser'],\n  created() {\n    const dzhyun = plugin.getInstance(this.$props);\n\n    // Vue只会注册一次插件\n    Vue.use(plugin, { dzhyun });\n    this.$dzhyun = dzhyun;\n  },\n  destroyed() {\n    // 实例销毁后，关闭连接\n    this.$dzhyun.close();\n  },\n  render(h) {\n    const children = this.$slots.default || [];\n    if (children.length <= 1) {\n      return children[0];\n    }\n    return h('div', { class: 'dzhyun-data-source' }, children);\n  },\n});\n\n\n\n// WEBPACK FOOTER //\n// ./src/DataSource.js","/**\n * Created by jiagang on 2017/5/16.\n */\nimport Vue from 'vue';\nimport DataQuery from './DataQuery';\n\nexport default Vue.component('dzhyun-data-subscribe', {\n  extends: DataQuery,\n  props: {\n    subscribe: {\n      type: Boolean,\n      default: true,\n    },\n  }\n})\n\n\n\n// WEBPACK FOOTER //\n// ./src/DataSubscribe.js","import plugin from './plugin';\nimport DzhyunDataSource from './DataSource';\nimport DzhyunDataQuery from './DataQuery';\nimport DzhyunDataSubscribe from './DataSubscribe';\n\nObject.assign(plugin, { DzhyunDataSource, DzhyunDataQuery, DzhyunDataSubscribe });\n\nmodule.exports = plugin;\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","module.exports = __WEBPACK_EXTERNAL_MODULE_6__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"Dzhyun\"\n// module id = 6\n// module chunks = 0 1"],"sourceRoot":""}